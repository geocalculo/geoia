<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoIA - Información del punto</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:16px;background:#f6f8fa;}
    h1{font-size:22px;margin-bottom:8px;}
    .muted{color:#666;font-size:12px;margin-top:4px;}
    table{border-collapse:collapse;min-width:360px;margin-top:10px;background:#fff;}
    th,td{border:1px solid #ddd;padding:8px;text-align:right;font-size:14px;}
    th{background:#eaeef2;text-align:center;}
    td:first-child{text-align:left;}
    #mini{height:260px;margin-top:16px;border-radius:6px;border:1px solid #ccc;}
    .wrapper{max-width:800px;margin:0 auto;}
    .pill{display:inline-block;background:#eef;padding:2px 8px;border-radius:12px;border:1px solid #cfe;font-size:11px;margin-top:6px;}
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Coordenadas del punto consultado</h1>
    <div class="muted">Valores calculados en WGS84 y UTM 19S (EPSG:32719). Mapa de referencia con OpenStreetMap.</div>

    <table id="tabla-coord">
      <thead>
        <tr><th>Sistema</th><th>Coordenadas</th></tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <span class="pill">Miniatura del mapa centrada en el punto</span>
    <div id="mini"></div>

    <p class="muted">
      Lat/Lon en grados decimales. Coordenadas UTM en metros. Si compartes esta URL, el mapa se abrirá en el mismo punto.
    </p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    function fmt(num, dec) {
      return Number(num).toFixed(dec);
    }

    const params = new URLSearchParams(window.location.search);
    const lat = parseFloat(params.get('lat'));
    const lon = parseFloat(params.get('lon'));
    const E   = parseFloat(params.get('E'));
    const N   = parseFloat(params.get('N'));

    const tbody = document.querySelector('#tabla-coord tbody');

    if (!isNaN(lat) && !isNaN(lon) && !isNaN(E) && !isNaN(N)) {
      tbody.innerHTML = `
        <tr>
          <td>WGS84 (lat, lon)</td>
          <td><b>${fmt(lat, 6)}</b>, <b>${fmt(lon, 6)}</b></td>
        </tr>
        <tr>
          <td>UTM 19S (EPSG:32719)</td>
          <td>E = <b>${fmt(E, 3)}</b> m, N = <b>${fmt(N, 3)}</b> m</td>
        </tr>
      `;
    } else {
      tbody.innerHTML = '<tr><td colspan="2" style="text-align:center;">No se encontraron parámetros de coordenadas en la URL.</td></tr>';
    }

    if (!isNaN(lat) && !isNaN(lon)) {
      const mini = L.map('mini', {
        zoomControl: false,
        attributionControl: true
      }).setView([lat, lon], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(mini);

      L.marker([lat, lon]).addTo(mini);

      setTimeout(() => mini.invalidateSize(), 100);
    }
  </script>
</body>
</html>
